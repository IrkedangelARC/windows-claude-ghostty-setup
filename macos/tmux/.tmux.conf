# Sensible defaults
set -g mouse on
set -g history-limit 100000
setw -g mode-keys vi
set -g base-index 1
setw -g pane-base-index 1

# Truecolor
set -ga terminal-overrides ",*:Tc"

# Faster key repeat
set -sg escape-time 10

# Split shortcuts (prefix is C-a below)
unbind C-b
set -g prefix C-a
bind C-a send-prefix
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind r source-file ~/.tmux.conf \; display-message "tmux reloaded"

# ============================================================================
# DEV LAYOUT: Three-pane Claude Code workflow
# ============================================================================
# Layout structure:
# ┌──────────────┬──────────────┐
# │              │   Terminal   │
# │    Claude    │   Editor     │
# │     Code     ├──────────────┤
# │              │   Output/    │
# │              │   Logs/Test  │
# └──────────────┴──────────────┘
#
# Prefix + d: Create dev layout
# Kill all other panes first, then create the layout from scratch
bind d kill-pane -a \; \
       split-window -h -p 40 -c "#{pane_current_path}" \; \
       split-window -v -p 40 -c "#{pane_current_path}" \; \
       select-pane -L \; \
       display-message "Dev layout created - Claude (left 60%) | Editor (top-right) | Output (bottom-right)"

# ============================================================================
# PANE NAVIGATION: Vim-style (h/j/k/l) and Arrow keys
# ============================================================================
# Vim-style navigation (prefix + h/j/k/l)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Arrow key navigation (prefix + arrow)
bind Left select-pane -L
bind Down select-pane -D
bind Up select-pane -U
bind Right select-pane -R

# Smart pane switching with awareness of Vim splits (optional - requires vim-tmux-navigator)
# Uncomment if you use vim/neovim and want seamless vim+tmux navigation
# is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
# bind -n C-h if-shell "$is_vim" "send-keys C-h"  "select-pane -L"
# bind -n C-j if-shell "$is_vim" "send-keys C-j"  "select-pane -D"
# bind -n C-k if-shell "$is_vim" "send-keys C-k"  "select-pane -U"
# bind -n C-l if-shell "$is_vim" "send-keys C-l"  "select-pane -R"

# ============================================================================
# PANE RESIZING: Fine and coarse adjustments
# ============================================================================
# Fine resize (prefix + H/J/K/L) - 2 cells at a time
bind -r H resize-pane -L 2
bind -r J resize-pane -D 2
bind -r K resize-pane -U 2
bind -r L resize-pane -R 2

# Coarse resize (prefix + Shift + Arrow) - 10 cells at a time for quick adjustments
bind -r S-Left resize-pane -L 10
bind -r S-Down resize-pane -D 5
bind -r S-Up resize-pane -U 5
bind -r S-Right resize-pane -R 10

# ============================================================================
# LAYOUT MANAGEMENT: Quick layout switching and zoom
# ============================================================================
# Cycle through tmux's built-in layouts (prefix + Space is default, keeping it)
# prefix + Space: cycle layouts
# prefix + z: toggle pane zoom (default tmux binding)

# Save current layout (prefix + S) - useful before experimenting
bind S command-prompt -p "Save layout as:" "run-shell 'tmux list-windows -F \"##I:##W ##P\" > ~/.tmux/layouts/%%.txt'"

# Balance panes evenly (prefix + =)
bind = select-layout tiled

# ============================================================================
# WORKFLOW ENHANCEMENTS: Quick actions for the dev layout
# ============================================================================
# Clear both right panes (editor + output) while keeping Claude visible (prefix + C)
bind C send-keys -t :.1 C-l \; send-keys -t :.2 C-l \; display-message "Right panes cleared"

# Maximize/restore editor pane (top-right) - prefix + e
bind e select-pane -t :.1 \; resize-pane -Z

# Maximize/restore output pane (bottom-right) - prefix + o
bind O select-pane -t :.2 \; resize-pane -Z

# Copy-mode (macOS clipboard integration via tmux-yank)
set -g set-clipboard on

# Status line
set -g status-interval 2
set -g status-left-length 60
set -g status-right-length 120

# Plugins (TPM)
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-battery'
# DISABLED: tmux-cpu plugin (using custom cpu-status.sh script instead)
# set -g @plugin 'tmux-plugins/tmux-cpu'
# DISABLED: catppuccin/tmux plugin was causing green backgrounds
# set -g @plugin 'catppuccin/tmux'

# Catppuccin theme settings (disabled - using custom status bar instead)
# set -g @catppuccin_flavour 'mocha'
# set -g @catppuccin_window_tabs_enabled on
# set -g @catppuccin_status_left_separator "#{?client_prefix,󰘳 ,}#S  #I:#W"
# set -g @catppuccin_status_right_separator "#(date +"%H:%M")  #{cpu_percentage}  #{battery_icon}#{battery_percentage}"

# Resurrect/Continuum
set -g @continuum-restore 'on'

# Custom status bar - Clean, minimal design with Catppuccin Mocha
set -g status 2

# Catppuccin Mocha color definitions for reference:
# Base: #1e1e2e (darkest background)
# Mantle: #181825 (slightly darker)
# Surface0: #313244 (subtle background)
# Surface1: #45475a (slightly lighter)
# Overlay0: #6c7086 (muted text)
# Subtext0: #a6adc8 (subtle text)
# Text: #cdd6f4 (main text)
# Lavender: #b4befe (subtle accent)
# Sapphire: #74c7ec (calm blue)
# Sky: #89dceb (light blue)
# Mauve: #cba6f7 (purple)

# Top status line - Workflow information (left: session/window, git, venv | right: time/date)
set -g status-format[0] '#[bg=#1e1e2e,fg=#b4befe] #S #[bg=#1e1e2e,fg=#45475a]▐#[bg=#1e1e2e,fg=#a6adc8] #I:#W #[bg=#1e1e2e,fg=#45475a]▐#[bg=#1e1e2e,fg=#74c7ec] #(~/.tmux/scripts/git-status.sh "#{pane_current_path}") #[bg=#1e1e2e,fg=#45475a]▐#[bg=#1e1e2e,fg=#89dceb] #(~/.tmux/scripts/python-venv.sh) #[bg=#1e1e2e,fg=#45475a]▐#[bg=#1e1e2e,fg=#cdd6f4] #{b:pane_current_path} #[align=right]#[bg=#1e1e2e,fg=#cba6f7]%H:%M #[bg=#1e1e2e,fg=#45475a]▐#[bg=#1e1e2e,fg=#a6adc8] %m/%d '

# Bottom status line - System information (left: prefix hint | right: network, memory, cpu)
set -g status-format[1] '#[bg=#181825,fg=#6c7086] prefix: C-a #[align=right]#[bg=#181825,fg=#74c7ec]#(~/.tmux/scripts/network-status.sh) #[bg=#181825,fg=#45475a]▐#[bg=#181825,fg=#cba6f7] #(~/.tmux/scripts/memory-status.sh) #[bg=#181825,fg=#45475a]▐#[bg=#181825,fg=#89dceb]#(~/.tmux/scripts/cpu-status.sh) '

set -g status-left-length 0
set -g status-right-length 0

# CRITICAL: Override ALL backgrounds to prevent ANY green colors
# These settings must come AFTER status-format to override plugin defaults
set -g status-style "bg=#1e1e2e,fg=#cdd6f4"
set -g window-status-style "bg=#1e1e2e,fg=#6c7086"
set -g window-status-current-style "bg=#313244,fg=#b4befe,bold"
set -g window-status-activity-style "bg=#1e1e2e,fg=#89dceb"
set -g window-status-bell-style "bg=#1e1e2e,fg=#f38ba8"

# Enhanced pane borders - heavy style with bright colors and indicators
set -g pane-border-lines heavy
set -g pane-border-status top
set -g pane-border-format " #[fg=#cba6f7]#{pane_index}#[fg=#6c7086]: #[fg=#a6adc8]#{pane_current_command} #[fg=#6c7086]│ #[fg=#74c7ec]#{pane_current_path} "
set -g pane-border-style "fg=#89dceb,bg=#181825"
set -g pane-active-border-style "fg=#f5c2e7,bg=#313244,bold"

set -g message-style "bg=#313244,fg=#cdd6f4"
set -g message-command-style "bg=#313244,fg=#cdd6f4"
set -g mode-style "bg=#313244,fg=#cdd6f4"

# Initialize TPM (commented out temporarily - install plugins later with: prefix + I)
# run '~/.tmux/plugins/tpm/tpm'
